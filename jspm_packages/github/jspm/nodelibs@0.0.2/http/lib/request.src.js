var Stream=require("../../stream"),Response=require("./response"),Base64=require("npm:Base64@^0.2.0"),inherits=require("npm:inherits@^2.0.1"),Request=module.exports=function(t,n){var e=this;e.writable=!0,e.xhr=t,e.body=[],e.uri=(n.scheme||"http")+"://"+n.host+(n.port?":"+n.port:"")+(n.path||"/");try{t.withCredentials=!0}catch(r){}if(t.open(n.method||"GET",e.uri,!0),n.headers)for(var i=objectKeys(n.headers),o=0;o<i.length;o++){var u=i[o];if(e.isSafeRequestHeader(u)){var a=n.headers[u];if(isArray(a))for(var s=0;s<a.length;s++)t.setRequestHeader(u,a[s]);else t.setRequestHeader(u,a)}}n.auth&&this.setHeader("Authorization","Basic "+Base64.btoa(n.auth));var f=new Response;f.on("close",function(){e.emit("close")}),f.on("ready",function(){e.emit("response",f)}),t.onreadystatechange=function(){f.handle(t)}};inherits(Request,Stream),Request.prototype.setHeader=function(t,n){if(isArray(n))for(var e=0;e<n.length;e++)this.xhr.setRequestHeader(t,n[e]);else this.xhr.setRequestHeader(t,n)},Request.prototype.write=function(t){this.body.push(t)},Request.prototype.destroy=function(){this.xhr.abort(),this.emit("close")},Request.prototype.end=function(t){if(void 0!==t&&this.body.push(t),0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(isArray(this.body[0])){for(var n=[],e=0;e<this.body.length;e++)n.push.apply(n,this.body[e]);this.xhr.send(n)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var r=0,e=0;e<this.body.length;e++)r+=this.body[e].length;for(var n=new this.body[0].constructor(r),i=0,e=0;e<this.body.length;e++)for(var o=this.body[e],u=0;u<o.length;u++)n[i++]=o[u];this.xhr.send(n)}else{for(var n="",e=0;e<this.body.length;e++)n+=this.body[e].toString();this.xhr.send(n)}},Request.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],Request.prototype.isSafeRequestHeader=function(t){return t?-1===indexOf(Request.unsafeHeaders,t.toLowerCase()):!1};var objectKeys=Object.keys||function(t){var n=[];for(var e in t)n.push(e);return n},isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf=function(t,n){if(t.indexOf)return t.indexOf(n);for(var e=0;e<t.length;e++)if(t[e]===n)return e;return-1};
//# sourceMappingURL=jspm_packages\github\jspm\nodelibs@0.0.2/http\lib\request.src.js.map