function parseHeaders(t){for(var n=t.getAllResponseHeaders().split(/\r?\n/),e={},r=0;r<n.length;r++){var i=n[r];if(""!==i){var o=i.match(/^([^:]+):\s*(.*)/);if(o){var u=o[1].toLowerCase(),a=o[2];void 0!==e[u]?isArray(e[u])?e[u].push(a):e[u]=[e[u],a]:e[u]=a}else e[i]=!0}}return e}var Stream=require("../../stream"),util=require("../../util"),Response=module.exports=function(){this.offset=0,this.readable=!0};util.inherits(Response,Stream);var capable={streaming:!0,status2:!0};Response.prototype.getResponse=function(t){var n=String(t.responseType).toLowerCase();return"blob"===n?t.responseBlob||t.response:"arraybuffer"===n?t.response:t.responseText},Response.prototype.getHeader=function(t){return this.headers[t.toLowerCase()]},Response.prototype.handle=function(t){if(2===t.readyState&&capable.status2){try{this.statusCode=t.status,this.headers=parseHeaders(t)}catch(n){capable.status2=!1}capable.status2&&this.emit("ready")}else if(capable.streaming&&3===t.readyState){try{this.statusCode||(this.statusCode=t.status,this.headers=parseHeaders(t),this.emit("ready"))}catch(n){}try{this._emitData(t)}catch(n){capable.streaming=!1}}else 4===t.readyState&&(this.statusCode||(this.statusCode=t.status,this.emit("ready")),this._emitData(t),t.error?this.emit("error",this.getResponse(t)):this.emit("end"),this.emit("close"))},Response.prototype._emitData=function(t){var n=this.getResponse(t);return n.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(n,this.offset)),void(this.offset=n.byteLength)):void(n.length>this.offset&&(this.emit("data",n.slice(this.offset)),this.offset=n.length))};var isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};
//# sourceMappingURL=jspm_packages\github\jspm\nodelibs@0.0.2/http\lib\response.js.map