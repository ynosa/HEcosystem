function define(t,e){var n=e.tagName,r=e.tagNames||(n?[n]:[]),o=e.parentClass||core.HTMLElement,i=e.attributes||[],a=e.proto||{},u=core[t]=function(t,e){o.call(this,t,e||n.toUpperCase()),u._init&&u._init.call(this)};u._init=e.init,u.prototype=a,u.prototype.__proto__=o.prototype,i.forEach(function(t){var e=t.prop||t,n=t.attr||e.toLowerCase();t.prop&&t.read===!1||u.prototype.__defineGetter__(e,function(){var e=this.getAttribute(n);return t.type&&"boolean"===t.type?null!==e:t.type&&"long"===t.type?+e:"object"==typeof t&&t.normalize?t.normalize(e):e}),t.prop&&t.write===!1||u.prototype.__defineSetter__(e,function(e){if(e){var r=e.toString();t.normalize&&(r=t.normalize(r)),this.setAttribute(n,r)}else this.removeAttribute(n)})}),r.forEach(function(t){core.Document.prototype._elementBuilders[t.toLowerCase()]=function(t,e){var n=new u(t,e);return n}})}function closest(t,e){for(e=e.toUpperCase();t;){if(t.nodeName.toUpperCase()===e||t.tagName&&t.tagName.toUpperCase()===e)return t;t=t._parentNode}return null}function descendants(t,e,n){var r=n?t._ownerDocument||t:t;return new core.HTMLCollection(r,core.mapper(t,function(t){return t.nodeName===e&&"undefined"==typeof t._publicId},n))}function firstChild(t,e){if(!t)return null;var n=descendants(t,e,!1);return n.length>0?n[0]:null}function ResourceQueue(t){this.paused=!!t}function loadFrame(t){t._contentDocument&&(t._contentDocument._parentWindow?t._contentDocument.parentWindow.close():delete t._contentDocument);var e=t.src,n=t._ownerDocument,r=core.resourceLoader.resolve(n,e),o=t._contentDocument=new core.HTMLDocument({url:r,documentRoot:Path.dirname(r)});applyDocumentFeatures(o,n.implementation._features);var i=n.parentWindow,a=o.parentWindow;a.parent=i,a.top=i.top,core.resourceLoader.load(t,r,function(t){o.write(t),o.close()})}var core=require("./core").dom.level2.core,events=require("./core").dom.level2.events,applyDocumentFeatures=require("../browser/documentfeatures").applyDocumentFeatures,URL=require("url"),Path=require("path"),fs=require("fs"),http=require("http"),https=require("https");core=Object.create(core),core.languageProcessors={javascript:require("./languages/javascript").javascript},core.resourceLoader={load:function(t,e,n){var r=t._ownerDocument.implementation;if(r.hasFeature("FetchExternalResources",t.tagName.toLowerCase())){var o=this.resolve(t._ownerDocument,e),i=URL.parse(o);if(r.hasFeature("SkipExternalResources",o))return!1;i.hostname?this.download(i,this.baseUrl(t._ownerDocument),this.enqueue(t,n,o)):this.readFile(i.pathname,this.enqueue(t,n,o))}},enqueue:function(t,e,n){var r=t.nodeType===core.Node.DOCUMENT_NODE?t:t._ownerDocument;return r._queue?r._queue.push(function(o,i){var a=r.createEvent("HTMLEvents");if(!o)try{e.call(t,i,n||r.URL),a.initEvent("load",!1,!1)}catch(u){o=u}o&&(a.initEvent("error",!1,!1),a.error=o),t.dispatchEvent(a)}):function(){}},baseUrl:function(t){var e=t.getElementsByTagName("base"),n=t.URL;return e.length>0&&(n=e.item(0).href||n),n},resolve:function(t,e){if(null===e)return"";if(e.match(/^\w+:\/\//))return e;var n=this.baseUrl(t);return e.match(/^\/\//)?n?n.match(/^(\w+:)\/\//)[1]+e:null:(e.match(/^\/[^\/]/)||(e=e.replace(/^\//,"")),URL.resolve(n,e))},download:function(t,e,n){var r,o=t.pathname+(t.search||""),i={method:"GET",host:t.hostname,path:o};"https:"===t.protocol?(i.port=t.port||443,r=https.request(i)):(i.port=t.port||80,r=http.request(i)),e&&r.setHeader("Referer",e),r.on("response",function(r){function o(){if([301,302,303,307].indexOf(r.statusCode)>-1){var o=URL.resolve(t,r.headers.location);core.resourceLoader.download(URL.parse(o),e,n)}else n(null,i)}var i="";r.setEncoding("utf8"),r.on("data",function(t){i+=t.toString()}),r.on("end",function(){r.removeAllListeners("close"),o()}),r.on("close",function(t){t?n(t):o()})}),r.on("error",n),r.end()},readFile:function(t,e){fs.readFile(t.replace(/^file:\/\//,"").replace(/^\/([a-z]):\//i,"$1:/").replace(/%20/g," "),"utf8",e)}},core.HTMLCollection=function(t,e){this._keys=[],core.NodeList.call(this,t,e)},core.HTMLCollection.prototype={namedItem:function(t){if(Object.prototype.hasOwnProperty.call(this,t))return this[t];for(var e,n=this._toArray(),r=n.length,o=null,i=0;r>i;i++){if(e=n[i],e.getAttribute("id")===t)return e;e.getAttribute("name")===t&&(o=e)}return o},toString:function(){return"[ jsdom HTMLCollection ]: contains "+this.length+" items"},_resetTo:function(t){function e(t,e){var n=t.getAttribute(e);n&&!Object.prototype.hasOwnProperty.call(r,n)&&(r[n]=t,r._keys.push(n))}var n,r=this;for(n=0;n<this._keys.length;++n)delete this[this._keys[n]];for(this._keys=[],core.NodeList.prototype._resetTo.apply(this,arguments),n=0;n<t.length;++n)e(t[n],"id");for(n=0;n<t.length;++n)e(t[n],"name")}},Object.defineProperty(core.HTMLCollection.prototype,"constructor",{value:core.NodeList,writable:!0,configurable:!0}),core.HTMLCollection.prototype.__proto__=core.NodeList.prototype,core.HTMLOptionsCollection=core.HTMLCollection,ResourceQueue.prototype={push:function(t){var e=this,n={prev:e.tail,check:function(){e.paused||this.prev||!this.fired||(t(this.err,this.data),this.next?(this.next.prev=null,this.next.check()):e.tail=null)}};return e.tail&&(e.tail.next=n),e.tail=n,function(t,e){n.fired=1,n.err=t,n.data=e,n.check()}},resume:function(){if(this.paused){this.paused=!1;for(var t=this.tail;t&&t.prev;)t=t.prev;t&&t.check()}}},core.HTMLDocument=function(t){t=t||{},t.contentType||(t.contentType="text/html"),core.Document.call(this,t),this._referrer=t.referrer,this._cookie=t.cookie,this._URL=t.url||"/",this._documentRoot=t.documentRoot||Path.dirname(this._URL),this._queue=new ResourceQueue(t.deferClose),this.readyState="loading",this.implementation.addFeature("core","2.0"),this.implementation.addFeature("html","2.0"),this.implementation.addFeature("xhtml","2.0"),this.implementation.addFeature("xml","2.0")},core.HTMLDocument.prototype={_referrer:"",get referrer(){return this._referrer||""},get domain(){return""},_URL:"",get URL(){return this._URL},get images(){return this.getElementsByTagName("IMG")},get applets(){return new core.HTMLCollection(this,core.mapper(this,function(t){if(t&&t.tagName){var e=t.tagName.toUpperCase();if("APPLET"===e)return!0;if("OBJECT"===e&&t.getElementsByTagName("APPLET").length>0)return!0}}))},get links(){return new core.HTMLCollection(this,core.mapper(this,function(t){if(t&&t.tagName){var e=t.tagName.toUpperCase();if("AREA"===e||"A"===e&&t.href)return!0}}))},get forms(){return this.getElementsByTagName("FORM")},get anchors(){return this.getElementsByTagName("A")},open:function(){this._childNodes=new core.NodeList,this._documentElement=null,this._modified()},close:function(){this._queue.resume(),core.resourceLoader.enqueue(this,function(){this.readyState="complete";var t=this.createEvent("HTMLEvents");t.initEvent("DOMContentLoaded",!1,!1),this.dispatchEvent(t)})(null,!0)},write:function(t){if(this._writeAfterElement){var e=this.createElement("div");e.innerHTML=t;for(var n=e.firstChild,r=this._writeAfterElement,o=this._writeAfterElement.parentNode;n;){var i=n;n=n.nextSibling,o.insertBefore(i,r.nextSibling),r=i}}else if("loading"===this.readyState){for(var i=this;i.lastChild&&i.lastChild.nodeType===this.ELEMENT_NODE;)i=i.lastChild;i.innerHTML=t}else this.innerHTML=t},writeln:function(t){this.write(t+"\n")},getElementsByName:function(t){return new core.HTMLCollection(this,core.mapper(this,function(e){return e.getAttribute&&e.getAttribute("name")===t}))},get title(){var t=this.head,e=t?firstChild(t,"TITLE"):null;return e?e.textContent:""},set title(t){var e=firstChild(this.head,"TITLE");if(!e){e=this.createElement("TITLE");var n=this.head;n||(n=this.createElement("HEAD"),this.documentElement.insertBefore(n,this.documentElement.firstChild)),n.appendChild(e)}e.textContent=t},get head(){return firstChild(this.documentElement,"HEAD")},set head(){},get body(){var t=firstChild(this.documentElement,"BODY");return t||(t=firstChild(this.documentElement,"FRAMESET")),t},get documentElement(){return this._documentElement||(this._documentElement=firstChild(this,"HTML")),this._documentElement},_cookie:"",get cookie(){return this._cookie||""},set cookie(t){this._cookie=t}},core.HTMLDocument.prototype.__proto__=core.Document.prototype,define("HTMLElement",{parentClass:core.Element,proto:{dispatchEvent:function(t){var e=core.Node.prototype.dispatchEvent.call(this,t);return!t._preventDefault&&t.target._eventDefaults[t.type]&&"function"==typeof t.target._eventDefaults[t.type]&&t.target._eventDefaults[t.type](t),e},_eventDefaults:{}},attributes:["id","title","lang","dir",{prop:"className",attr:"class",normalize:function(t){return t||""}}]}),core.Document.prototype._defaultElementBuilder=function(t,e){return new core.HTMLElement(t,e)};var listedElements=/button|fieldset|input|keygen|object|select|textarea/i;define("HTMLFormElement",{tagName:"FORM",proto:{get elements(){return new core.HTMLCollection(this._ownerDocument,core.mapper(this,function(t){return listedElements.test(t.nodeName)}))},get length(){return this.elements.length},_dispatchSubmitEvent:function(){var t=this._ownerDocument.createEvent("HTMLEvents");t.initEvent("submit",!0,!0),this.dispatchEvent(t)||this.submit()},submit:function(){},reset:function(){this.elements._toArray().forEach(function(t){t.value=t.defaultValue})}},attributes:["name",{prop:"acceptCharset",attr:"accept-charset"},"action","enctype","method","target"]}),define("HTMLLinkElement",{tagName:"LINK",proto:{get href(){return core.resourceLoader.resolve(this._ownerDocument,this.getAttribute("href"))}},attributes:[{prop:"disabled",type:"boolean"},"charset","href","hreflang","media","rel","rev","target","type"]}),define("HTMLMetaElement",{tagName:"META",attributes:["content",{prop:"httpEquiv",attr:"http-equiv"},"name","scheme"]}),define("HTMLHtmlElement",{tagName:"HTML",attributes:["version"]}),define("HTMLHeadElement",{tagName:"HEAD",attributes:["profile"]}),define("HTMLTitleElement",{tagName:"TITLE",proto:{get text(){return this.innerHTML},set text(t){this.innerHTML=t}}}),define("HTMLBaseElement",{tagName:"BASE",attributes:["href","target"]}),define("HTMLIsIndexElement",{tagName:"ISINDEX",parentClass:core.Element,proto:{get form(){return closest(this,"FORM")}},attributes:["prompt"]}),define("HTMLStyleElement",{tagName:"STYLE",attributes:[{prop:"disabled",type:"boolean"},"media","type"]}),define("HTMLBodyElement",{proto:function(){var t={};return["onafterprint","onbeforeprint","onbeforeunload","onblur","onerror","onfocus","onhashchange","onload","onmessage","onoffline","ononline","onpagehide","onpageshow","onpopstate","onresize","onscroll","onstorage","onunload"].forEach(function(e){t.__defineSetter__(e,function(t){this._ownerDocument.parentWindow[e]=t}),t.__defineGetter__(e,function(){return this._ownerDocument.parentWindow[e]})}),t}(),tagName:"BODY",attributes:["aLink","background","bgColor","link","text","vLink"]}),define("HTMLSelectElement",{tagName:"SELECT",proto:{get options(){return new core.HTMLOptionsCollection(this,core.mapper(this,function(t){return"OPTION"===t.nodeName}))},get length(){return this.options.length},get selectedIndex(){return this.options._toArray().reduceRight(function(t,e,n){return e.selected?n:t},-1)},set selectedIndex(t){this.options._toArray().forEach(function(e,n){e.selected=n===t})},get value(){var t=this.selectedIndex;return this.options.length&&-1===t&&(t=0),-1===t?"":this.options[t].value},set value(t){var e=this;this.options._toArray().forEach(function(n){n.value===t?n.selected=!0:e.hasAttribute("multiple")||(n.selected=!1)})},get form(){return closest(this,"FORM")},get type(){return this.multiple?"select-multiple":"select-one"},add:function(t,e){e?this.insertBefore(t,e):this.appendChild(t)},remove:function(t){var e=this.options._toArray();if(t>=0&&t<e.length){var n=e[t];n._parentNode.removeChild(n)}},blur:function(){this._ownerDocument.activeElement=this._ownerDocument.body},focus:function(){this._ownerDocument.activeElement=this}},attributes:[{prop:"disabled",type:"boolean"},{prop:"multiple",type:"boolean"},"name",{prop:"size",type:"long"},{prop:"tabIndex",type:"long"}]}),define("HTMLOptGroupElement",{tagName:"OPTGROUP",attributes:[{prop:"disabled",type:"boolean"},"label"]}),define("HTMLOptionElement",{tagName:"OPTION",proto:{_attrModified:function(t){"selected"===t&&(this.selected=this.defaultSelected),core.HTMLElement.prototype._attrModified.call(this,arguments)},get form(){return closest(this,"FORM")},get defaultSelected(){return null!==this.getAttribute("selected")},set defaultSelected(t){t?this.setAttribute("selected","selected"):this.removeAttribute("selected")},get text(){return this.innerHTML},get value(){return this.hasAttribute("value")?this.getAttribute("value"):this.innerHTML},set value(t){this.setAttribute("value",t)},get index(){return closest(this,"SELECT").options._toArray().indexOf(this)},get selected(){if(void 0===this._selected&&(this._selected=this.defaultSelected),!this._selected&&this.parentNode){var t=closest(this,"SELECT");if(t){var e=t.options;if(e.item(0)===this&&!t.hasAttribute("multiple")){for(var n=e._toArray(),r=1,o=n.length;o>r;r++)if(n[r]._selected)return!1;return!0}}}return this._selected},set selected(t){if(this._selected=!!t,t){var e=this._parentNode;if(!e)return;if("SELECT"!==e.nodeName){if(e=e._parentNode,!e)return;if("SELECT"!==e.nodeName)return}if(!e.multiple)for(var n=e.options,r=0;r<n.length;r++)n[r]!==this&&(n[r].selected=!1)}}},attributes:[{prop:"disabled",type:"boolean"},"label"]}),define("HTMLInputElement",{tagName:"INPUT",init:function(){this.hasAttribute("type")||this.setAttribute("type","text")},proto:{_initDefaultValue:function(){if(void 0===this._defaultValue){var t=this.getAttributeNode("value");this._defaultValue=t?t.value:null}return this._defaultValue},_initDefaultChecked:function(){return void 0===this._defaultChecked&&(this._defaultChecked=!!this.getAttribute("checked")),this._defaultChecked},get form(){return closest(this,"FORM")},get defaultValue(){return this._initDefaultValue()},get defaultChecked(){return this._initDefaultChecked()},get checked(){return!!this._attributes.getNamedItem("checked")},set checked(t){if(this._initDefaultChecked(),t){if(this.setAttribute("checked","checked"),"radio"===this.type)for(var e=this._ownerDocument.getElementsByName(this.name),n=0;n<e.length;n++)e[n]!==this&&"INPUT"===e[n].tagName&&"radio"===e[n].type&&(e[n].checked=!1)}else this.removeAttribute("checked")},get value(){return this.getAttribute("value")},set value(t){this._initDefaultValue(),null===t?this.removeAttribute("value"):this.setAttribute("value",t)},blur:function(){this._ownerDocument.activeElement=this._ownerDocument.body},focus:function(){this._ownerDocument.activeElement=this},select:function(){},_dispatchClickEvent:function(){var t=this._ownerDocument.createEvent("HTMLEvents");t.initEvent("click",!0,!0),this.dispatchEvent(t)},click:function(){if("checkbox"===this.type)this.checked=!this.checked;else if("radio"===this.type)this.checked=!0;else if("submit"===this.type){var t=this.form;t&&t._dispatchSubmitEvent()}this._dispatchClickEvent()}},attributes:["accept","accessKey","align","alt",{prop:"disabled",type:"boolean"},{prop:"maxLength",type:"long"},"name",{prop:"readOnly",type:"boolean"},{prop:"size",type:"long"},"src",{prop:"tabIndex",type:"long"},{prop:"type",normalize:function(t){return t?t.toLowerCase():"text"}},"useMap"]}),define("HTMLTextAreaElement",{tagName:"TEXTAREA",proto:{_initDefaultValue:function(){return void 0===this._defaultValue&&(this._defaultValue=this.textContent),this._defaultValue},get form(){return closest(this,"FORM")},get defaultValue(){return this._initDefaultValue()},get value(){return this.textContent},set value(t){this._initDefaultValue(),this.textContent=t},get type(){return"textarea"},blur:function(){this._ownerDocument.activeElement=this._ownerDocument.body},focus:function(){this._ownerDocument.activeElement=this},select:function(){}},attributes:["accessKey",{prop:"cols",type:"long"},{prop:"disabled",type:"boolean"},{prop:"maxLength",type:"long"},"name",{prop:"readOnly",type:"boolean"},{prop:"rows",type:"long"},{prop:"tabIndex",type:"long"}]}),define("HTMLButtonElement",{tagName:"BUTTON",proto:{get form(){return closest(this,"FORM")},focus:function(){this._ownerDocument.activeElement=this},blur:function(){this._ownerDocument.activeElement=this._ownerDocument.body}},attributes:["accessKey",{prop:"disabled",type:"boolean"},"name",{prop:"tabIndex",type:"long"},"type","value"]}),define("HTMLLabelElement",{tagName:"LABEL",proto:{get form(){return closest(this,"FORM")}},attributes:["accessKey",{prop:"htmlFor",attr:"for"}]}),define("HTMLFieldSetElement",{tagName:"FIELDSET",proto:{get form(){return closest(this,"FORM")}}}),define("HTMLLegendElement",{tagName:"LEGEND",proto:{get form(){return closest(this,"FORM")}},attributes:["accessKey","align"]}),define("HTMLUListElement",{tagName:"UL",attributes:[{prop:"compact",type:"boolean"},"type"]}),define("HTMLOListElement",{tagName:"OL",attributes:[{prop:"compact",type:"boolean"},{prop:"start",type:"long"},"type"]}),define("HTMLDListElement",{tagName:"DL",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLDirectoryElement",{tagName:"DIR",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLMenuElement",{tagName:"MENU",attributes:[{prop:"compact",type:"boolean"}]}),define("HTMLLIElement",{tagName:"LI",attributes:["type",{prop:"value",type:"long"}]}),define("HTMLCanvasElement",{tagName:"CANVAS",attributes:["align"]}),define("HTMLDivElement",{tagName:"DIV",attributes:["align"]}),define("HTMLParagraphElement",{tagName:"P",attributes:["align"]}),define("HTMLHeadingElement",{tagNames:["H1","H2","H3","H4","H5","H6"],attributes:["align"]}),define("HTMLQuoteElement",{tagNames:["Q","BLOCKQUOTE"],attributes:["cite"]}),define("HTMLPreElement",{tagName:"PRE",attributes:[{prop:"width",type:"long"}]}),define("HTMLBRElement",{tagName:"BR",attributes:["clear"]}),define("HTMLBaseFontElement",{tagName:"BASEFONT",attributes:["color","face",{prop:"size",type:"long"}]}),define("HTMLFontElement",{tagName:"FONT",attributes:["color","face","size"]}),define("HTMLHRElement",{tagName:"HR",attributes:["align",{prop:"noShade",type:"boolean"},"size","width"]}),define("HTMLModElement",{tagNames:["INS","DEL"],attributes:["cite","dateTime"]}),define("HTMLAnchorElement",{tagName:"A",proto:{blur:function(){this._ownerDocument.activeElement=this._ownerDocument.body},focus:function(){this._ownerDocument.activeElement=this},get href(){return core.resourceLoader.resolve(this._ownerDocument,this.getAttribute("href"))},get hostname(){return URL.parse(this.href).hostname},get pathname(){return URL.parse(this.href).pathname}},attributes:["accessKey","charset","coords",{prop:"href",type:"string",read:!1},"hreflang","name","rel","rev","shape",{prop:"tabIndex",type:"long"},"target","type"]}),define("HTMLImageElement",{tagName:"IMG",proto:{get src(){return core.resourceLoader.resolve(this._ownerDocument,this.getAttribute("src"))}},attributes:["name","align","alt","border",{prop:"height",type:"long"},{prop:"hspace",type:"long"},{prop:"isMap",type:"boolean"},"longDesc",{prop:"src",type:"string",read:!1},"useMap",{prop:"vspace",type:"long"},{prop:"width",type:"long"}]}),define("HTMLObjectElement",{tagName:"OBJECT",proto:{get form(){return closest(this,"FORM")},get contentDocument(){return null}},attributes:["code","align","archive","border","codeBase","codeType","data",{prop:"declare",type:"boolean"},{prop:"height",type:"long"},{prop:"hspace",type:"long"},"name","standby",{prop:"tabIndex",type:"long"},"type","useMap",{prop:"vspace",type:"long"},{prop:"width",type:"long"}]}),define("HTMLParamElement",{tagName:"PARAM",attributes:["name","type","value","valueType"]}),define("HTMLAppletElement",{tagName:"APPLET",attributes:["align","alt","archive","code","codeBase","height",{prop:"hspace",type:"long"},"name","object",{prop:"vspace",type:"long"},"width"]}),define("HTMLMapElement",{tagName:"MAP",proto:{get areas(){return this.getElementsByTagName("AREA")}},attributes:["name"]}),define("HTMLAreaElement",{tagName:"AREA",attributes:["accessKey","alt","coords","href",{prop:"noHref",type:"boolean"},"shape",{prop:"tabIndex",type:"long"},"target"]}),define("HTMLScriptElement",{tagName:"SCRIPT",init:function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.src)core.resourceLoader.load(this,this.src,this._eval);else{var t=this.sourceLocation||{},e=t.file||this._ownerDocument.URL;t&&(e+=":"+t.line+":"+t.col),e+="<script>",core.resourceLoader.enqueue(this,this._eval,e)(null,this.text)}})},proto:{_eval:function(t,e){this._ownerDocument.implementation.hasFeature("ProcessExternalResources","script")&&this.language&&core.languageProcessors[this.language]&&(this._ownerDocument._writeAfterElement=this,core.languageProcessors[this.language](this,t,e),delete this._ownerDocument._writeAfterElement)},get language(){var t=this.type||"text/javascript";return t.split("/").pop().toLowerCase()},get text(){var t=0,e=this.childNodes,n=e.length,r=[];for(t;n>t;t++)r.push(e.item(t).nodeValue);return r.join("")},set text(t){for(;this.childNodes.length;)this.removeChild(this.childNodes[0]);this.appendChild(this._ownerDocument.createTextNode(t))}},attributes:[{prop:"defer",type:"boolean"},"htmlFor","event","charset","type","src"]}),define("HTMLTableElement",{tagName:"TABLE",proto:{get caption(){return firstChild(this,"CAPTION")},get tHead(){return firstChild(this,"THEAD")},get tFoot(){return firstChild(this,"TFOOT")},get rows(){if(!this._rows){var t=this;this._rows=new core.HTMLCollection(this._ownerDocument,function(){var e=[t.tHead].concat(t.tBodies._toArray(),t.tFoot).filter(function(t){return!!t});return 0===e.length?core.mapDOMNodes(t,!1,function(t){return"TR"===t.tagName}):e.reduce(function(t,e){return t.concat(e.rows._toArray())},[])})}return this._rows},get tBodies(){return this._tBodies||(this._tBodies=descendants(this,"TBODY",!1)),this._tBodies},createTHead:function(){var t=this.tHead;return t||(t=this._ownerDocument.createElement("THEAD"),this.appendChild(t)),t},deleteTHead:function(){var t=this.tHead;t&&t._parentNode.removeChild(t)},createTFoot:function(){var t=this.tFoot;return t||(t=this._ownerDocument.createElement("TFOOT"),this.appendChild(t)),t},deleteTFoot:function(){var t=this.tFoot;t&&t._parentNode.removeChild(t)},createCaption:function(){var t=this.caption;return t||(t=this._ownerDocument.createElement("CAPTION"),this.appendChild(t)),t},deleteCaption:function(){var t=this.caption;t&&t._parentNode.removeChild(t)},insertRow:function(t){var e=this._ownerDocument.createElement("TR");0===this.childNodes.length&&this.appendChild(this._ownerDocument.createElement("TBODY"));var n=this.rows._toArray();if(-1>t||t>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(-1===t||0===t&&0===n.length)this.tBodies.item(0).appendChild(e);else if(t===n.length){var r=n[t-1];r._parentNode.appendChild(e)}else{var r=n[t];r._parentNode.insertBefore(e,r)}return e},deleteRow:function(t){var e=this.rows._toArray(),n=e.length;if(-1===t&&(t=n-1),0>t||t>=n)throw new core.DOMException(core.INDEX_SIZE_ERR);var r=e[t];r._parentNode.removeChild(r)}},attributes:["align","bgColor","border","cellPadding","cellSpacing","frame","rules","summary","width"]}),define("HTMLTableCaptionElement",{tagName:"CAPTION",attributes:["align"]}),define("HTMLTableColElement",{tagNames:["COL","COLGROUP"],attributes:["align",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"span",type:"long"},"vAlign","width"]}),define("HTMLTableSectionElement",{tagNames:["THEAD","TBODY","TFOOT"],proto:{get rows(){return this._rows||(this._rows=descendants(this,"TR",!1)),this._rows},insertRow:function(t){var e=this._ownerDocument.createElement("TR"),n=this.rows._toArray();if(-1>t||t>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(-1===t||t===n.length)this.appendChild(e);else{var r=n[t];this.insertBefore(e,r)}return e},deleteRow:function(t){var e=this.rows._toArray();if(-1===t&&(t=e.length-1),0>t||t>=e.length)throw new core.DOMException(core.INDEX_SIZE_ERR);var n=this.rows[t];this.removeChild(n)}},attributes:["align",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"span",type:"long"},"vAlign","width"]}),define("HTMLTableRowElement",{tagName:"TR",proto:{get cells(){return this._cells||(this._cells=new core.HTMLCollection(this,core.mapper(this,function(t){return"TD"===t.nodeName||"TH"===t.nodeName},!1))),this._cells},get rowIndex(){var t=closest(this,"TABLE");return t?t.rows._toArray().indexOf(this):-1},get sectionRowIndex(){return this._parentNode.rows._toArray().indexOf(this)},insertCell:function(t){var e=this._ownerDocument.createElement("TD"),n=this.cells._toArray();if(-1>t||t>n.length)throw new core.DOMException(core.INDEX_SIZE_ERR);if(-1===t||t===n.length)this.appendChild(e);else{var r=n[t];this.insertBefore(e,r)}return e},deleteCell:function(t){var e=this.cells._toArray();if(-1===t&&(t=e.length-1),0>t||t>=e.length)throw new core.DOMException(core.INDEX_SIZE_ERR);var n=this.cells[t];this.removeChild(n)}},attributes:["align","bgColor",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},"vAlign"]}),define("HTMLTableCellElement",{tagNames:["TH","TD"],proto:{_headers:null,set headers(t){return""===t?void(this._headers=null):(t instanceof Array||(t=[t]),void(this._headers=t))},get headers(){if(this._headers)return this._headers.join(" ");for(var t=this.cellIndex,e=[],n=this._parentNode.getElementsByTagName(this.tagName),r=0;r<n.length&&!(n.item(r).cellIndex>=t);r++)e.push(n.item(r).id);return this._headers=e,e.join(" ")},get cellIndex(){return closest(this,"TR").cells._toArray().indexOf(this)}},attributes:["abbr","align","axis","bgColor",{prop:"ch",attr:"char"},{prop:"chOff",attr:"charoff"},{prop:"colSpan",type:"long"},"height",{prop:"noWrap",type:"boolean"},{prop:"rowSpan",type:"long"},"scope","vAlign","width"]}),define("HTMLFrameSetElement",{tagName:"FRAMESET",attributes:["cols","rows"]}),define("HTMLFrameElement",{tagName:"FRAME",init:function(){var t=this._ownerDocument.parentWindow,e=t._length++,n=this;t.__defineGetter__(e,function(){return n.contentWindow}),this._initInsertListener=this.addEventListener("DOMNodeInsertedIntoDocument",function(){var e=n._ownerDocument,r=n.contentDocument;applyDocumentFeatures(r,e.implementation._features);var o=n.contentWindow;o.parent=t,o.top=t.top},!1)},proto:{setAttribute:function(t,e){core.HTMLElement.prototype.setAttribute.call(this,t,e);var n=this;"name"===t?this._ownerDocument.parentWindow.__defineGetter__(e,function(){return n.contentWindow}):"src"===t&&(this._attachedToDocument?loadFrame(n):this._waitingOnInsert||(this.removeEventListener("DOMNodeInsertedIntoDocument",this._initInsertListener,!1),this.addEventListener("DOMNodeInsertedIntoDocument",function r(){n.removeEventListener("DOMNodeInsertedIntoDocument",r,!1),this._waitingOnInsert=!1,loadFrame(n)},!1),this._waitingOnInsert=!0))},_contentDocument:null,get contentDocument(){return null==this._contentDocument&&(this._contentDocument=new core.HTMLDocument),this._contentDocument},get contentWindow(){return this.contentDocument.parentWindow}},attributes:["frameBorder","longDesc","marginHeight","marginWidth","name",{prop:"noResize",type:"boolean"},"scrolling",{prop:"src",type:"string",write:!1}]}),define("HTMLIFrameElement",{tagName:"IFRAME",parentClass:core.HTMLFrameElement,attributes:["align","frameBorder","height","longDesc","marginHeight","marginWidth","name","scrolling","src","width"]}),exports.define=define,exports.dom={level2:{html:core}};
//# sourceMappingURL=jspm_packages/npm/jsdom@0.5.7/level2/html.js.map