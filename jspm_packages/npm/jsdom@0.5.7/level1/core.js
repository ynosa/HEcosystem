/*
  ServerJS Javascript DOM Level 1
*/
function lengthFromProperties(t){var n=-1;for(var e in t){var r=+e;!isNaN(r)&&r>n&&(n=r)}return n+1}var attachId=function(t,n,e){t&&n&&e&&(e._ids[t]||(e._ids[t]=[]),e._ids[t].push(n))},detachId=function(t,n,e){var r,o;if(t&&n&&e&&e._ids&&e._ids[t]){for(r=e._ids[t],o=0;o<r.length;o++)r[o]===n&&(r.splice(o,1),o--);0===r.length&&delete e._ids[t]}},core={mapper:function(t,n,e){return function(){return core.mapDOMNodes(t,e!==!1,n)}},mapDOMNodes:function(t,n,e){function r(t,n){return Array.prototype.reduce.call(t.childNodes,o,n)}function o(t,o){return e(o)&&t.push(o),n&&o._childNodes&&r(o,t),t}return r(t,[])},visitTree:function(t,n){function e(t){if(t&&(n(t),t._childNodes)){var r=0,o=t._childNodes,i=o.length;for(r;i>r;r++)e(o[r])}}e(t)},markTreeReadonly:function(t){function n(t){if(t._readonly=!0,t.attributes){var e=t.attributes,r=e.length,o=0;for(e._readonly=!0,o;r>o;o++)core.visitTree(e[o],n)}}core.visitTree(t,n)}},INDEX_SIZE_ERR=core.INDEX_SIZE_ERR=1,DOMSTRING_SIZE_ERR=core.DOMSTRING_SIZE_ERR=2,HIERARCHY_REQUEST_ERR=core.HIERARCHY_REQUEST_ERR=3,WRONG_DOCUMENT_ERR=core.WRONG_DOCUMENT_ERR=4,INVALID_CHARACTER_ERR=core.INVALID_CHARACTER_ERR=5,NO_DATA_ALLOWED_ERR=core.NO_DATA_ALLOWED_ERR=6,NO_MODIFICATION_ALLOWED_ERR=core.NO_MODIFICATION_ALLOWED_ERR=7,NOT_FOUND_ERR=core.NOT_FOUND_ERR=8,NOT_SUPPORTED_ERR=core.NOT_SUPPORTED_ERR=9,INUSE_ATTRIBUTE_ERR=core.INUSE_ATTRIBUTE_ERR=10,ELEMENT_NODE=1,ATTRIBUTE_NODE=2,TEXT_NODE=3,CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=5,ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=8,DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=12,messages=core.exceptionMessages={};messages[INDEX_SIZE_ERR]="Index size error",messages[DOMSTRING_SIZE_ERR]="DOMString size error",messages[HIERARCHY_REQUEST_ERR]="Hierarchy request error",messages[WRONG_DOCUMENT_ERR]="Wrong document",messages[INVALID_CHARACTER_ERR]="Invalid character",messages[NO_DATA_ALLOWED_ERR]="No data allowed",messages[NO_MODIFICATION_ALLOWED_ERR]="No modification allowed",messages[NOT_FOUND_ERR]="Not found",messages[NOT_SUPPORTED_ERR]="Not supported",messages[INUSE_ATTRIBUTE_ERR]="Attribute in use",core.DOMException=function(t,n){this.code=t,Error.call(this,core.exceptionMessages[t]),this.message=core.exceptionMessages[t],n&&(this.message=this.message+": "+n),Error.captureStackTrace&&Error.captureStackTrace(this,core.DOMException)},core.DOMException.INDEX_SIZE_ERR=INDEX_SIZE_ERR,core.DOMException.DOMSTRING_SIZE_ERR=DOMSTRING_SIZE_ERR,core.DOMException.HIERARCHY_REQUEST_ERR=HIERARCHY_REQUEST_ERR,core.DOMException.WRONG_DOCUMENT_ERR=WRONG_DOCUMENT_ERR,core.DOMException.INVALID_CHARACTER_ERR=INVALID_CHARACTER_ERR,core.DOMException.NO_DATA_ALLOWED_ERR=NO_DATA_ALLOWED_ERR,core.DOMException.NO_MODIFICATION_ALLOWED_ERR=NO_MODIFICATION_ALLOWED_ERR,core.DOMException.NOT_FOUND_ERR=NOT_FOUND_ERR,core.DOMException.NOT_SUPPORTED_ERR=NOT_SUPPORTED_ERR,core.DOMException.INUSE_ATTRIBUTE_ERR=INUSE_ATTRIBUTE_ERR,core.DOMException.prototype={INDEX_SIZE_ERR:INDEX_SIZE_ERR,DOMSTRING_SIZE_ERR:DOMSTRING_SIZE_ERR,HIERARCHY_REQUEST_ERR:HIERARCHY_REQUEST_ERR,WRONG_DOCUMENT_ERR:WRONG_DOCUMENT_ERR,INVALID_CHARACTER_ERR:INVALID_CHARACTER_ERR,NO_DATA_ALLOWED_ERR:NO_DATA_ALLOWED_ERR,NO_MODIFICATION_ALLOWED_ERR:NO_MODIFICATION_ALLOWED_ERR,NOT_FOUND_ERR:NOT_FOUND_ERR,NOT_SUPPORTED_ERR:NOT_SUPPORTED_ERR,INUSE_ATTRIBUTE_ERR:INUSE_ATTRIBUTE_ERR},core.DOMException.prototype.__proto__=Error.prototype,core.NodeList=function(t,n){n?(Object.defineProperties(this,{_element:{value:t},_query:{value:n},_snapshot:{writable:!0},_length:{value:0,writable:!0},_version:{value:-1,writable:!0}}),this._update()):(Array.isArray(t)&&Array.prototype.push.apply(this,t),Object.defineProperties(this,{_length:{value:t?t.length:0,writable:!0}}))},core.NodeList.prototype={_update:function(){if(this._element){if(this._version<this._element._version){var t=this._snapshot=this._query();this._resetTo(t),this._version=this._element._version}}else this._length=lengthFromProperties(this)},_resetTo:function(t){for(var n=lengthFromProperties(this),e=0;n>e;++e)delete this[e];for(var r=0;r<t.length;++r)this[r]=t[r];this._length=t.length},_toArray:function(){return this._element?(this._update(),this._snapshot):Array.prototype.slice.call(this)},get length(){return this._update(),this._length||0},item:function(t){return this._update(),this[t]||null},toString:function(){return"[ jsdom NodeList ]: contains "+this.length+" items"}},Object.defineProperty(core.NodeList.prototype,"constructor",{value:core.NodeList,writable:!0,configurable:!0}),core.DOMImplementation=function(t,n){if(this._ownerDocument=t,this._features={},n)for(var e in n)n.hasOwnProperty(e)&&this.addFeature(e.toLowerCase(),n[e])},core.DOMImplementation.prototype={get ownerDocument(){return this._ownerDocument},removeFeature:function(t,n){if(t=t.toLowerCase(),this._features[t])if(n){var e=0,r=this._features[t],o=r.length;for(e;o>e;e++)if(r[e]===n)return void r.splice(e,1)}else delete this._features[t]},addFeature:function(t,n){t=t.toLowerCase(),n&&(this._features[t]||(this._features[t]=[]),n instanceof Array?Array.prototype.push.apply(this._features[t],n):this._features[t].push(n))},hasFeature:function(t,n){t=t?t.toLowerCase():"";var e=this._features[t]?this._features[t]:!1;if(!n&&e.length&&e.length>0)return!0;if("string"==typeof e)return e===n;if(e.indexOf&&e.length>0){for(var r=0;r<e.length;r++){var o=e[r]instanceof RegExp?e[r].test(n):e[r]===n;if(o)return!0}return!1}return!1}};var attrCopy=function(t,n,e){if(t.attributes){var r,o,i,a=t.attributes,u=a.length;for(r=0;u>r;r++)if(o=a[r],o.specified){if(o.namespaceURI){n.setAttributeNS(o.namespaceURI,o.nodeName,o.nodeValue);var c=o.nodeName.split(":").pop();i=n.getAttributeNodeNS(o.namespaceURI,c)}else n.setAttribute(o.nodeName,o.nodeValue),i=n.getAttributeNode(o.nodeName);"function"==typeof e&&e(o,i)}}return n};core.Node=function(t){this._childNodes=new core.NodeList,this._ownerDocument=t,this._attributes=new core.AttrNodeMap(t,this),this._nodeName=null,this._childrenList=null,this._version=0,this._nodeValue=null,this._parentNode=null,this._nodeName=null,this._readonly=!1},core.Node.ELEMENT_NODE=ELEMENT_NODE,core.Node.ATTRIBUTE_NODE=ATTRIBUTE_NODE,core.Node.TEXT_NODE=TEXT_NODE,core.Node.CDATA_SECTION_NODE=CDATA_SECTION_NODE,core.Node.ENTITY_REFERENCE_NODE=ENTITY_REFERENCE_NODE,core.Node.ENTITY_NODE=ENTITY_NODE,core.Node.PROCESSING_INSTRUCTION_NODE=PROCESSING_INSTRUCTION_NODE,core.Node.COMMENT_NODE=COMMENT_NODE,core.Node.DOCUMENT_NODE=DOCUMENT_NODE,core.Node.DOCUMENT_TYPE_NODE=DOCUMENT_TYPE_NODE,core.Node.DOCUMENT_FRAGMENT_NODE=DOCUMENT_FRAGMENT_NODE,core.Node.NOTATION_NODE=NOTATION_NODE,core.Node.prototype={ELEMENT_NODE:ELEMENT_NODE,ATTRIBUTE_NODE:ATTRIBUTE_NODE,TEXT_NODE:TEXT_NODE,CDATA_SECTION_NODE:CDATA_SECTION_NODE,ENTITY_REFERENCE_NODE:ENTITY_REFERENCE_NODE,ENTITY_NODE:ENTITY_NODE,PROCESSING_INSTRUCTION_NODE:PROCESSING_INSTRUCTION_NODE,COMMENT_NODE:COMMENT_NODE,DOCUMENT_NODE:DOCUMENT_NODE,DOCUMENT_TYPE_NODE:DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT_NODE:DOCUMENT_FRAGMENT_NODE,NOTATION_NODE:NOTATION_NODE,get children(){if(!this._childrenList){var t=this;this._childrenList=new core.NodeList(this,function(){return Array.prototype.filter.call(t._childNodes,function(t){return t.tagName})})}return this._childrenList},get nodeValue(){return this._nodeValue},set nodeValue(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR,"Attempting to modify a read-only node");this._nodeValue=t},get parentNode(){return this._parentNode},get nodeName(){var t=this._nodeName||this._tagName;return this.nodeType===ELEMENT_NODE&&this._ownerDocument&&this._ownerDocument._doctype&&-1!==this._ownerDocument._doctype.name.toLowerCase().indexOf("html")?t.toUpperCase():t},set nodeName(){throw new core.DOMException},get attributes(){return this._attributes},get firstChild(){return this._childNodes.length>0?this._childNodes[0]:null},set firstChild(){throw new core.DOMException},get ownerDocument(){return this._ownerDocument},get readonly(){return this._readonly},get lastChild(){var t=this._childNodes.length;return t>0?this._childNodes[t-1]:null},set lastChild(){throw new core.DOMException},get childNodes(){return this._childNodes},set childNodes(){throw new core.DOMException},_indexOf:function(t){if(!this._childNodes||!this._childNodes.length)return-1;for(var n,e=0,r=this._childNodes;(n=r[e])&&n!=t;)e++;return n==t?e:-1},get nextSibling(){if(!this._parentNode||!this._parentNode._indexOf)return null;var t=this._parentNode._indexOf(this);return-1==t||t+1>=this._parentNode._childNodes.length?null:this._parentNode._childNodes[t+1]||null},set nextSibling(){throw new core.DOMException},get previousSibling(){if(!this._parentNode||!this._parentNode._indexOf)return null;var t=this._parentNode._indexOf(this);return-1==t||0>t-1?null:this._parentNode._childNodes[t-1]||null},set previousSibling(){throw new core.DOMException},insertBefore:function(t,n){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR,"Attempting to modify a read-only node");if(t._ownerDocument||(t._ownerDocument=this._ownerDocument),t._ownerDocument!==this._ownerDocument)throw new core.DOMException(WRONG_DOCUMENT_ERR);if(t.nodeType&&t.nodeType===ATTRIBUTE_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);var e=this;do if(e===t)throw new core.DOMException(HIERARCHY_REQUEST_ERR);while(e=e._parentNode);if(t.nodeType===DOCUMENT_FRAGMENT_NODE)for(var r;t._childNodes.length>0;)r=t.removeChild(t.firstChild),this.insertBefore(r,n);else{if(t===n)return t;if(t._parentNode&&t._parentNode.removeChild(t),null==n)var o=this._childNodes.length;else{var o=this._indexOf(n);if(-1==o)throw new core.DOMException(NOT_FOUND_ERR)}Array.prototype.splice.call(this._childNodes,o,0,t),t._parentNode=this,this._attached&&t._attach&&t._attach(),this._modified()}return t},_modified:function(){this._version++,this._ownerDocument&&this._ownerDocument._version++,this._childrenList&&this._childrenList._update()},_attrModified:function(t,n,e){if("id"==t&&this._attached){var r=this._ownerDocument;detachId(e,this,r),attachId(n,this,r)}if(t.length>2&&"o"==t[0]&&"n"==t[1])if(n){var o=this,i="undefined"!=typeof o.run?o:o._ownerDocument.parentWindow;o[t]=function(t){i.__tempContextForInlineEventHandler=o,i.__tempEvent=t,i.run("if ((function (event) {"+n+"}).call(window.__tempContextForInlineEventHandler, window.__tempEvent) === false) {window.__tempEvent.preventDefault()}"),delete i.__tempContextForInlineEventHandler,delete i.__tempEvent}}else this[t]=null},replaceChild:function(t,n){return this.insertBefore(t,n),this.removeChild(n)},_attach:function(){this._attached=!0,this.id&&attachId(this.id,this,this._ownerDocument);for(var t=0;t<this._childNodes.length;t++)this._childNodes[t]._attach&&this._childNodes[t]._attach()},_detach:function(){var t;this._attached=!1,this.id&&detachId(this.id,this,this._ownerDocument);for(var t=0;t<this._childNodes.length;t++)this._childNodes[t]._detach()},removeChild:function(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);var n=this._indexOf(t);if(-1==n)throw new core.DOMException(NOT_FOUND_ERR);return Array.prototype.splice.call(this._childNodes,n,1),t._parentNode=null,this._modified(),t._detach(),t},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return this._childNodes.length>0},cloneNode:function(t,n){var e=null;switch(this.nodeType){case this.ELEMENT_NODE:e=attrCopy(this,this._ownerDocument.createElement(this.tagName),n);break;case this.TEXT_NODE:e=attrCopy(this,this._ownerDocument.createTextNode(this.tagName)),e.nodeValue=this.nodeValue;break;case this.CDATA_SECTION_NODE:e=this._ownerDocument.createCDATASection(this.tagName),e.nodeValue=this.nodeValue;break;case this.ENTITY_REFERENCE_NODE:var r=this._entity?this._entity.name:this._entityName,o=this._ownerDocument.createEntityReference(r);e=attrCopy(this,o),e.nodeValue=this.nodeValue;break;case this.ATTRIBUTE_NODE:e=this._ownerDocument.createAttribute(this.name);break;case this.ENTITY_NODE:var i=this._ownerDocument.createEntityNode(this.name);e=attrCopy(this,i),e.nodeValue=this.nodeValue,e._publicId=this._publicId,e._systemId=this._systemId,e._notationName=this.notationName;break;case this.PROCESSING_INSTRUCTION_NODE:var a=this._ownerDocument.createProcessingInstruction(this._target,this._data);e=attrCopy(this,a),e.nodeValue=this.nodeValue;break;case this.COMMENT_NODE:e=this._ownerDocument.createComment(this.tagName),e.nodeValue=this.nodeValue;break;case this.DOCUMENT_NODE:e=attrCopy(this,new core.Document);break;case this.DOCUMENT_TYPE_NODE:e=attrCopy(this,new core.DocumentType),e.nodeValue=this.nodeValue;break;case this.DOCUMENT_FRAGMENT_NODE:e=this._ownerDocument.createDocumentFragment();break;case this.NOTATION_NODE:e=this._ownerDocument.createNotationNode(this._name,this._publicId,this._systemId),e=attrCopy(this,e),e.nodeValue=this.nodeValue;break;default:throw new core.DOMException(NOT_FOUND_ERR)}if("function"==typeof n&&n(this,e),t||this.nodeType===ATTRIBUTE_NODE)for(var u=null,c=0,s=this._childNodes.length;s>c;c++)if(u=this._childNodes[c].cloneNode(!0),u.nodeType===ATTRIBUTE_NODE)e.setAttributeNode(u);else{var l=e._readonly;e._readonly=!1,e.appendChild(u),e._readonly=l}return e},normalize:function(){var t,n,e,r;if(this._attributes&&this._attributes.length)for(r=0;r<this._attributes.length;r++)this._attributes.item(r)&&(e=this._attributes.item(r).normalize());for(r=0;r<this._childNodes.length;r++)n=this._childNodes[r],n.normalize&&n.normalize(),""!==n.nodeValue?r>0&&(t=this._childNodes[r-1],n.nodeType===TEXT_NODE&&t.nodeType===TEXT_NODE&&(t.appendData(n.nodeValue),this.removeChild(n),r--)):(this.removeChild(n),r--)},toString:function(){var t="";if(this.id&&(t="#"+this.id),this.className)for(var n=this.className.split(/\s+/),e=0,r=n.length;r>e;e++)t+="."+n[e];return"[ "+this.tagName+t+" ]"},raise:function(t,n,e){var r=t+": "+n;if(e&&(e.exception?r=e.exception.stack:r+=" - More:\n"+e),"error"===t){this.errors||(this.errors=[]);var o={type:t,message:n||"No message",data:e||null};this.errors.push(o),this._ownerDocument&&this._ownerDocument.raise&&this!==this._ownerDocument&&this._ownerDocument.raise(t,n,e)}}},core.NamedNodeMap=function(t){this._nodes={},this._nsStore={},this.length=0,this._ownerDocument=t,this._readonly=!1},core.NamedNodeMap.prototype={get readonly(){return this._readonly},get ownerDocument(){this._ownerDocument},exists:function(t){return this._nodes[t]||null===this._nodes[t]?!0:!1},getNamedItem:function(t){return this._nodes[t]||null},setNamedItem:function(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(t&&t._ownerDocument!==this._ownerDocument)throw new core.DOMException(WRONG_DOCUMENT_ERR);if(t&&t._ownerElement)throw new core.DOMException(INUSE_ATTRIBUTE_ERR);var n=t.name||t.tagName,e=this._nodes[n];return e||(this.length++,e=null),t._specified=!0,this[n]=this._nodes[n]=t,e},removeNamedItem:function(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(!this._nodes.hasOwnProperty(t))throw new core.DOMException(NOT_FOUND_ERR);var n=this._nodes[t]||null;return delete this._nodes[t],delete this[t],this.length--,n},item:function(t){var n=0;for(var e in this._nodes)if(this._nodes.hasOwnProperty(e)){if(n===t&&this._nodes[e])return this._nodes[e];n++}return null}},core.AttrNodeMap=function(t,n){core.NamedNodeMap.call(this,t),this._parentNode=n},core.AttrNodeMap.prototype={get parentNode(){return this._parentNode},setNamedItem:function(t){var n=core.NamedNodeMap.prototype.setNamedItem.call(this,t),e=this._parentNode;return t._ownerElement=e,e._attrModified(t.name,t.value,n&&n.value||null),e._modified(),n},removeNamedItem:function(t){var n=core.NamedNodeMap.prototype.removeNamedItem.call(this,t),e=this._parentNode;n._ownerElement=null,e._attrModified(t),e._modified();var r=this._ownerDocument;if(r&&r._doctype&&"html"!==r._doctype.name.toLowerCase()){var o=!1,i=r._doctype._attributes.getNamedItem(this._parentNode.nodeName);if(i){var o=i.attributes.getNamedItem(t);if(o){var a=r.createAttribute(t);a.value=o.value,a._specified=!1,this._nodes[t]=a,this.length++}}}return n}},core.AttrNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.NotationNodeMap=function(t){core.NamedNodeMap.call(this,t),this._readonly=!1;for(var n=1;n<arguments.length;n++)this.setNamedItem(arguments[n]);this._readonly=!0},core.NotationNodeMap.prototype={},core.NotationNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.EntityNodeMap=function(t){core.NamedNodeMap.call(this,t),this._readonly=!1;var n=1,e=arguments.length;for(n=1;e>n;n++)this.setNamedItem(arguments[n]);core.markTreeReadonly(this)},core.EntityNodeMap.prototype={},core.EntityNodeMap.prototype.__proto__=core.NamedNodeMap.prototype,core.Element=function(t,n){this._ownerDocument=t,core.Node.call(this,t),this._nodeName=n,this._tagName=n},core.Element.prototype={get nodeValue(){return null},set nodeValue(t){},get tagName(){return this.nodeType===ELEMENT_NODE&&this._ownerDocument&&this._ownerDocument._doctype&&-1!==this._ownerDocument._doctype.name.toLowerCase().indexOf("html")?this.nodeName.toUpperCase():this.nodeName},nodeType:ELEMENT_NODE,get attributes(){for(var t=0;t<this._attributes.length;t++)this._attributes[t]=this._attributes.item(t);return this._attributes},getAttribute:function(t){var n=this._attributes.getNamedItem(t);return n?n.value:null},setAttribute:function(t,n){if(this._ownerDocument){var e=this._ownerDocument.createAttribute(t);e.value=n,this._attributes.setNamedItem(e)}},removeAttribute:function(t){this._attributes.exists(t)&&this._attributes.removeNamedItem(t)},getAttributeNode:function(t){return this._attributes.getNamedItem(t)},setAttributeNode:function(t){var n=this._attributes.getNamedItem(t.name);return n&&(n._ownerElement=null),this._attributes.setNamedItem(t),n&&n.specified?n:null},removeAttributeNode:function(t){var n=this._attributes.getNamedItem(t.name);if(this._attributes&&n===t)return this._attributes.removeNamedItem(t.name),t;throw new core.DOMException(NOT_FOUND_ERR)},getElementsByTagName:function(t){function n(n){return n=n.nodeType===ENTITY_REFERENCE_NODE?n._entity:n,n.nodeName&&n.nodeType===ELEMENT_NODE?"*"===t||n.nodeName.toLowerCase()===t:!1}return t=t.toLowerCase(),new core.NodeList(this._ownerDocument||this,core.mapper(this,n,!0))}},core.Element.prototype.__proto__=core.Node.prototype,core.DocumentFragment=function(t){core.Node.call(this,t),this._nodeName=this._tagName="#document-fragment"},core.DocumentFragment.prototype={nodeType:DOCUMENT_FRAGMENT_NODE,get nodeValue(){return null},set nodeValue(){},get attributes(){return null}},core.DocumentFragment.prototype.__proto__=core.Node.prototype,core.ProcessingInstruction=function(t,n,e){this._ownerDocument=t,core.Node.call(this,t),this._nodeName=n,this._tagName=n,this._target=n,this._nodeValue=e},core.ProcessingInstruction.prototype={nodeType:PROCESSING_INSTRUCTION_NODE,get target(){return this._target},set target(t){throw new core.DOMException(1)},get nodeValue(){return this._nodeValue},set nodeValue(t){this._nodeValue=t},get data(){return this._nodeValue},set data(){throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR)},get attributes(){return null}},core.ProcessingInstruction.prototype.__proto__=core.Node.prototype,core.Document=function(t){t?"string"==typeof t&&(t={name:t}):t={},core.Node.call(this,"#document"),this._nodeName=this._tagName="#document",this._contentType=t.contentType||"text/xml",this._doctype=t._doctype,this._implementation=t.implementation||new core.DOMImplementation,this._documentElement=null,this._ids=Object.create(null),this._attached=!0,this._ownerDocument=this,this._readonly=!1};var tagRegEx=/[^\w:\d_\.-]+/i,entRegEx=/[^\w\d_\-&;]+/,invalidAttrRegEx=/[^\w:\d_\.-]+/;core.Document.prototype={nodeType:DOCUMENT_NODE,_elementBuilders:{canvas:function(t,n){var e,r=new core.Element(t,n);try{e=new(require("canvas"))(0,0);for(var o in r)e[o]||(e[o]=r[o]);return e}catch(i){return r}}},_defaultElementBuilder:function(t,n){return new core.Element(t,n)},get contentType(){return this._contentType},get doctype(){return this._doctype||null},set doctype(t){this._doctype=t},get documentElement(){if(this._documentElement)return this._documentElement;var t=this._childNodes,n=this._childNodes.length,e=0;for(e;n>e;e++)if(t[e].nodeType===ELEMENT_NODE)return this._documentElement=t[e],t[e];return null},get implementation(){return this._implementation},set implementation(t){this._implementation=t},get nodeName(){return"#document"},get tagName(){return null},get nodeValue(){return null},set nodeValue(){},get attributes(){return null},get ownerDocument(){return null},get readonly(){return this._readonly},createElement:function(t){var n,e=[],r=t.toLowerCase();if(!t||!t.match||(e=t.match(tagRegEx)))throw new core.DOMException(INVALID_CHARACTER_ERR,"Invalid character in tag name: "+e.pop());if(n=(this._elementBuilders[r]||this._defaultElementBuilder)(this,t),this._doctype&&this._doctype._attributes&&"html"!==this._doctype.name.toLowerCase()){var o=this._doctype._attributes.getNamedItem(t);if(o&&o._childNodes)for(var i,a,u=o.attributes,c=u.length,s=0;c>s;s++)a=u.item(s),a&&(i=this.createAttribute(a.name),i.value=a.value,n.setAttributeNode(i),i._specified=!1)}return n._created=!0,n},createDocumentFragment:function(){return new core.DocumentFragment(this)},createTextNode:function(t){return new core.Text(this,t)},createComment:function(t){return new core.Comment(this,t)},createCDATASection:function(t){if(this._doctype&&"html"===this._doctype.name)throw new core.DOMException(NOT_SUPPORTED_ERR);return new core.CDATASection(this,t)},createProcessingInstruction:function(t,n){if(this._doctype&&"html"===this._doctype.name)throw new core.DOMException(NOT_SUPPORTED_ERR);if(t.match(tagRegEx)||!t||!t.length)throw new core.DOMException(INVALID_CHARACTER_ERR);return new core.ProcessingInstruction(this,t,n)},createAttribute:function(t){if(!t||!t.length||t.match(invalidAttrRegEx))throw new core.DOMException(INVALID_CHARACTER_ERR,"attribute name: "+t);return new core.Attr(this,t,!1)},createEntityReference:function(t){if(this._doctype&&"html"===this._doctype.name)throw new core.DOMException(NOT_SUPPORTED_ERR);if(t=t.replace(/[&;]/g,""),!t||!t.length)throw new core.DOMException(INVALID_CHARACTER_ERR);if(t.match(tagRegEx))throw new core.DOMException(INVALID_CHARACTER_ERR);var n;n=this._doctype&&this._doctype.entities?this._doctype.entities.getNamedItem(t):null;var e=new core.EntityReference(this,n);return e._entityName=t,e},createEntityNode:function(t){if(t.match(entRegEx)||!t||!t.length)throw new core.DOMException(INVALID_CHARACTER_ERR);var n=new core.Entity(this,t);n._readonly=!1;for(var e=1;e<arguments.length;e++)n.appendChild(arguments[e]);return core.markTreeReadonly(n),n},createNotationNode:function(t,n,e){if(t.match(entRegEx)||!t||!t.length)throw new core.DOMException(INVALID_CHARACTER_ERR);var r=new core.Notation(this,t,n,e);r._readonly=!1;for(var o=3;o<arguments.length;o++)r.appendChild(arguments[o]);return core.markTreeReadonly(r),r},appendChild:function(t){if(this.documentElement&&t.nodeType==ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.appendChild.call(this,t)},removeChild:function(t){var n=core.Node.prototype.removeChild.call(this,t);return t==this._documentElement&&(this._documentElement=null),n},getElementsByTagName:function(t){function n(n){if(n.nodeType&&n.nodeType===ENTITY_REFERENCE_NODE&&(n=n._entity),n.nodeName&&n.nodeType===ELEMENT_NODE){if("*"===t)return!0;if(n._ownerDocument&&n._ownerDocument._doctype&&n.nodeName.toLowerCase()===t.toLowerCase())return!0;if(n.nodeName.toLowerCase()===t.toLowerCase())return!0}return!1}return new core.NodeList(this.documentElement||this,core.mapper(this,n,!0))}},core.Document.prototype.__proto__=core.Node.prototype,core.CharacterData=function(t,n){core.Node.call(this,t),this._nodeValue=n+""},core.CharacterData.prototype={get data(){return this._nodeValue},set data(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);this._nodeValue=t},get length(){return this._nodeValue.length||0},substringData:function(t,n){if(0>n||0>t||t>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);return this._nodeValue.length<t+n?this._nodeValue.substring(t):this._nodeValue.substring(t,t+n)},appendData:function(t){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);return this._nodeValue+=t,this._nodeValue},insertData:function(t,n){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(0>t||t>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);var e=this._nodeValue.substring(0,t),r=this._nodeValue.substring(t);this._nodeValue=e+n+r},deleteData:function(t,n){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(0>t||t>this._nodeValue.length||0>n)throw new core.DOMException(INDEX_SIZE_ERR);var e=this._nodeValue.substring(0,t);this._nodeValue=t+n<this._nodeValue.length?e+this._nodeValue.substring(t+n):e},replaceData:function(t,n,e){if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(n=t+n>this._nodeValue.length?this.nodeValue.length-t:n,0>t||t>this._nodeValue.length||0>n)throw new core.DOMException(INDEX_SIZE_ERR);var r=this._nodeValue.substring(0,t),o=this._nodeValue.substring(t+n);this._nodeValue=r+e+o}},core.CharacterData.prototype.__proto__=core.Node.prototype,core.Attr=function(t,n,e){core.Node.call(this,t),this._nodeValue=e,this._name=n,this._specified=e?!0:!1,this._tagName=n,this._nodeName=n},core.Attr.prototype={nodeType:ATTRIBUTE_NODE,get nodeValue(){for(var t="",n=0,e=this._childNodes.length;e>n;n++){var r=this._childNodes[n];t+=r.nodeType===ENTITY_REFERENCE_NODE?Array.prototype.reduce.call(r.childNodes,function(t,n){return t+=n.nodeValue||n},""):r.nodeValue}return t},set nodeValue(t){if(this._readonly)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);this._childNodes._resetTo([this._ownerDocument.createTextNode(t)]),this._modified(),this._specified=!0;var n=this._nodeValue;this._nodeValue=t,this._ownerElement&&this._ownerElement._attrModified(this._name,t,n)},get name(){return this._name},get specified(){return this._specified},get value(){return this.nodeValue},set value(t){this.nodeValue=t},get parentNode(){return null},get attributes(){return null},insertBefore:function(t,n){if(t.nodeType===CDATA_SECTION_NODE||t.nodeType===ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.insertBefore.call(this,t,n)},appendChild:function(t){if(t.nodeType===CDATA_SECTION_NODE||t.nodeType===ELEMENT_NODE)throw new core.DOMException(HIERARCHY_REQUEST_ERR);return core.Node.prototype.appendChild.call(this,t)}},core.Attr.prototype.__proto__=core.Node.prototype,core.Text=function(t,n,e){core.CharacterData.call(this,t,n),this._nodeName="#text",this._readonly=e?!0:!1},core.Text.prototype={nodeType:TEXT_NODE,get attributes(){return null},splitText:function(t){if(this._readonly)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);if(0>t||t>this._nodeValue.length)throw new core.DOMException(INDEX_SIZE_ERR);var n=this._nodeValue.substring(t);this._nodeValue=this._nodeValue.substring(0,t);var e=this._ownerDocument.createTextNode(n);return this._parentNode.lastChild===this?this._parentNode.appendChild(e):this._parentNode.insertBefore(e,this.nextSibling),e},toString:function(){return this.nodeName}},core.Text.prototype.__proto__=core.CharacterData.prototype,core.Comment=function(t,n){core.Text.call(this,t,n),this._nodeName="#comment",this._tagName="#comment"},core.Comment.prototype={nodeType:COMMENT_NODE},core.Comment.prototype.__proto__=core.Text.prototype,core.CDATASection=function(t,n){core.Text.call(this,t,n),this._nodeName="#cdata-section"},core.CDATASection.prototype={nodeType:CDATA_SECTION_NODE},core.CDATASection.prototype.__proto__=core.Text.prototype,core.DocumentType=function(t,n,e,r,o){core.Node.call(this,t),this._name=n,this._tagName=n,this._nodeName=n,this._entities=e||new core.EntityNodeMap(t),this._notations=r||new core.NotationNodeMap(t),core.markTreeReadonly(this._notations),this._attributes=o||new core.AttrNodeMap(t)},core.DocumentType.prototype={nodeType:DOCUMENT_TYPE_NODE,get nodeValue(){return null},set nodeValue(){},get name(){return this._name},get entities(){return this._entities},get notations(){return this._notations},get attributes(){return null}},core.DocumentType.prototype.__proto__=core.Node.prototype,core.Notation=function(t,n,e,r){core.Node.call(this,t),this._name=n,this._nodeName=n,this._publicId=e||null,this._systemId=r||null,this._nodeValue=null},core.Notation.prototype={nodeType:NOTATION_NODE,get publicId(){return this._publicId},get systemId(){return this._systemId},get name(){return this._name||this._nodeName},get attributes(){return null},set nodeValue(){},get nodeValue(){return this._nodeValue}},core.Notation.prototype.__proto__=core.Node.prototype,core.Entity=function(t,n){core.Node.call(this,t),this._name=n,this._nodeName=n,this._tagName=n,this._publicId=null,this._systemId=null,this._notationName=null,this._readonly=!0},core.Entity.prototype={nodeType:ENTITY_NODE,get nodeValue(){return null},set nodeValue(){this._readonly===!0},get name(){return this._name},get publicId(){return this._publicId},get systemId(){return this._systemId},set publicId(t){this._publicId=t},set systemId(t){this._systemId=t},set notationName(t){this._notationName=t},get notationName(){return this._notationName},get attributes(){return null}},core.Entity.prototype.__proto__=core.Node.prototype,core.EntityReference=function(t,n){core.Node.call(this,t),this._entity=n,this._nodeName=n?n.name:null,this._readonly=!0},core.EntityReference.prototype={nodeType:ENTITY_REFERENCE_NODE,get nodeValue(){return this._entity?this._entity.nodeValue:null},set nodeValue(){this._readonly===!0},get attributes(){return null},get nodeName(){return this._entityName},get firstChild(){return this._entity.firstChild||null},get childNodes(){return this._entity.childNodes},get lastChild(){return this._entity.lastChild||null}},core.EntityReference.prototype.__proto__=core.Node.prototype,exports.dom={level1:{core:core}};
//# sourceMappingURL=jspm_packages/npm/jsdom@0.5.7/level1/core.js.map